{% extends "universalLayout.html" %}
{% block title %}Update Journal{% endblock %}

{% block content %}
<h2>Update Journal</h2>
<p class="text-muted">Enter the Journal ID and update only the fields you want to change. Leave others blank.</p>

<form id="updateJournalForm" class="row g-3">

    <!-- Journal ID (Required for PUT) -->
    <div class="col-md-4">
        <label class="form-label">Journal ID</label>
        <input type="text" id="journalId" class="form-control" placeholder="J001" required>
    </div>

    <!-- Fields to update (all optional) -->
    <div class="col-md-8">
        <label class="form-label">Topic</label>
        <input type="text" name="topic" class="form-control">
    </div>

    <div class="col-md-6">
        <label class="form-label">Journal Name</label>
        <input type="text" name="journalName" class="form-control">
    </div>

    <div class="col-md-6">
        <label class="form-label">Short Journal Name</label>
        <input type="text" name="shortJournalName" class="form-control">
    </div>

    <div class="col-md-6">
        <label class="form-label">Author</label>
        <input type="text" name="author" class="form-control">
    </div>

    <div class="col-md-6">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control">
    </div>

    <div class="col-md-12">
        <label class="form-label">Author's Department</label>
        <input type="text" name="authorsDepartment" class="form-control">
    </div>

    <!-- Dates -->
    <div class="col-md-2"><label class="form-label">Received</label><input type="text" name="received"
            class="form-control" placeholder="01-Jan-2025"></div>
    <div class="col-md-2"><label class="form-label">Editor Assigned</label><input type="text" name="editorAssigned"
            class="form-control"></div>
    <div class="col-md-2"><label class="form-label">Reviewed</label><input type="text" name="reviewed"
            class="form-control"></div>
    <div class="col-md-2"><label class="form-label">Revised</label><input type="text" name="revised"
            class="form-control"></div>
    <div class="col-md-2"><label class="form-label">Published</label><input type="text" name="published"
            class="form-control"></div>

    <!-- Numbers -->
    <div class="col-md-3"><label class="form-label">Manuscript No</label><input type="text" name="manuscriptNo"
            class="form-control"></div>
    <div class="col-md-3"><label class="form-label">Volume</label><input type="number" name="volume"
            class="form-control"></div>
    <div class="col-md-3"><label class="form-label">Issue</label><input type="number" name="issues"
            class="form-control"></div>
    <div class="col-md-3"><label class="form-label">PDF No</label><input type="number" name="pdfNo"
            class="form-control"></div>

    <!-- Identifiers -->
    <div class="col-md-6"><label class="form-label">DOI</label><input type="text" name="doi" class="form-control"></div>
    <div class="col-md-6"><label class="form-label">ISSN</label><input type="text" name="ISSN" class="form-control">
    </div>
    <div class="col-md-12"><label class="form-label">Parent Link</label><input type="url" name="parentLink"
            class="form-control"></div>

    <!-- Submit -->
    <div class="col-12">
        <button type="submit" class="btn btn-warning">Update Journal</button>
    </div>
</form>

<!-- Response Section -->
<div id="responseBox" class="mt-4"></div>

<script>
    document.getElementById("updateJournalForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const journalId = document.getElementById("journalId").value.trim();
        if (!journalId) {
            alert("Please enter Journal ID.");
            return;
        }

        // Collect form data
        const formData = new FormData(this);
        let data = {};
        formData.forEach((value, key) => {
            if (value) data[key] = value;  // only send non-empty fields
        });

        showLoading();

        try {
            const response = await fetch(`/updateInputJournal/${journalId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            document.getElementById("responseBox").innerHTML = `
          <div class="alert alert-${response.ok ? 'success' : 'danger'}">
            ${JSON.stringify(result)}
          </div>`;
        } catch (error) {
            document.getElementById("responseBox").innerHTML = `
          <div class="alert alert-danger">Error: ${error}</div>`;
        } finally {
            hideLoading(); // hide spinner after response
        }
    });
</script>

{% endblock %}