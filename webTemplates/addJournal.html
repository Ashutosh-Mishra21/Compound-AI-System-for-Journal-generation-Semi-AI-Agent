{% extends "universalLayout.html" %}

{% block title %}Add Journal{% endblock %}

{% block content %}
<h2>Add Journal</h2>
<form id="formAddJournal" class="row g-3">

        <div class="col-md-4">
                <label class="form-label">Journal ID</label>
                <input type="text" name="id" class="form-control" required>
        </div>
        <div class="col-md-8">
                <label class="form-label">Topic</label>
                <input type="text" name="topic" class="form-control" required>
        </div>

        <div class="col-md-6">
                <label class="form-label">Journal Name</label>
                <input type="text" name="journalName" class="form-control" required>
        </div>
        <div class="col-md-6">
                <label class="form-label">Short Journal Name</label>
                <input type="text" name="shortJournalName" class="form-control" required>
        </div>

        <div class="col-md-4">
                <label class="form-label">Type</label>
                <input type="text" name="type" class="form-control" required>
        </div>
        <div class="col-md-8">
                <label class="form-label">Citation</label>
                <input type="text" name="citation" class="form-control" required>
        </div>

        <div class="col-md-6">
                <label class="form-label">Author</label>
                <input type="text" name="author" class="form-control" required>
        </div>
        <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" required>
        </div>

        <div class="col-md-12">
                <label class="form-label">Author's Department</label>
                <input type="text" name="authorsDepartment" class="form-control" required>
        </div>

        <!-- Dates -->
        <div class="col-md-2"><label class="form-label">Received</label><input type="text" name="received"
                        class="form-control" placeholder="01-Jan-2025" required></div>
        <div class="col-md-2"><label class="form-label">Editor Assigned</label><input type="text" name="editorAssigned"
                        class="form-control" required></div>
        <div class="col-md-2"><label class="form-label">Reviewed</label><input type="text" name="reviewed"
                        class="form-control" required></div>
        <div class="col-md-2"><label class="form-label">Revised</label><input type="text" name="revised"
                        class="form-control" required></div>
        <div class="col-md-2"><label class="form-label">Published</label><input type="text" name="published"
                        class="form-control" required></div>

        <div class="col-md-3"><label class="form-label">Manuscript No</label><input type="text" name="manuscriptNo"
                        class="form-control" required></div>
        <div class="col-md-3"><label class="form-label">Volume</label><input type="number" name="volume"
                        class="form-control" required></div>
        <div class="col-md-3"><label class="form-label">Issue</label><input type="number" name="issues"
                        class="form-control" required></div>
        <div class="col-md-3"><label class="form-label">PDF No</label><input type="number" name="pdfNo"
                        class="form-control" required></div>

        <div class="col-md-6"><label class="form-label">DOI</label><input type="text" name="doi" class="form-control"
                        required></div>
        <div class="col-md-6"><label class="form-label">ISSN</label><input type="text" name="ISSN" class="form-control"
                        required></div>
        <div class="col-md-12"><label class="form-label">Parent Link</label><input type="url" name="parentLink"
                        class="form-control" required></div>

        <div class="col-12">
                <button type="submit" class="btn btn-primary">Add Journal</button>
        </div>
</form>

<div id="responseBox" class="mt-4"></div>

<script>
        document.getElementById("formAddJournal").addEventListener("submit", async function (e) {
                e.preventDefault();

                const formData = new FormData(this);
                let data = {};
                formData.forEach((value, key) => data[key] = value);

                showLoading();

                try {
                        const response = await fetch("/addJournalInInput", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data)
                        });

                        const result = await response.json();
                        document.getElementById("responseBox").innerHTML = `
          <div class="alert alert-${response.ok ? 'success' : 'danger'}">
            <h5>Response body:</h5>
            <pre>${JSON.stringify(result, null, 2)}</pre>
          </div>`;
                } catch (error) {
                        document.getElementById("responseBox").innerHTML = `
          <div class="alert alert-danger">Error: ${error}</div>`;
                } finally {
                        hideLoading(); // hide spinner after response
                }
        });
</script>

{% endblock %}