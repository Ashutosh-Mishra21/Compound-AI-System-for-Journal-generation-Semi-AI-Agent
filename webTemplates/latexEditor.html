<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <title>LaTeX Editor - Journal Automation</title>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/stex/stex.min.js"></script>
     <style>
          body {
               margin: 0;
               font-family: Arial, sans-serif;
               background: #1e1e1e;
               color: #fff;
               height: 100vh;
               display: flex;
               flex-direction: column;
          }

          header {
               background: #2d2d2d;
               padding: 10px 20px;
               font-size: 18px;
               font-weight: bold;
          }

          main {
               flex: 1;
               display: grid;
               grid-template-columns: 50% 50%;
               height: 100%;
          }

          #editor {
               height: 100%;
          }

          #pdf-viewer {
               width: 100%;
               height: 100%;
               border: none;
               background: #fff;
          }

          #controls {
               padding: 10px;
               background: #2d2d2d;
               display: flex;
               justify-content: space-between;
          }

          button {
               background: #6c63ff;
               border: none;
               padding: 8px 16px;
               color: #fff;
               border-radius: 4px;
               cursor: pointer;
          }

          button:hover {
               background: #574bff;
          }

          #error-box {
               background: #ff4b4b;
               padding: 8px;
               margin-top: 5px;
               display: none;
               white-space: pre-wrap;
          }
     </style>
</head>

<body>
     <header>Journal Automation - LaTeX Editor</header>

     <div id="controls">
          <button onclick="compileLatex()">Compile PDF</button>
     </div>

     <main>
          <textarea id="editor">\\documentclass{article}
\\begin{document}
Hello Journal Automation!
\\end{document}</textarea>
          <iframe id="pdf-viewer"></iframe>
     </main>

     <div id="error-box"></div>

     <script>
          // CodeMirror setup
          const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
               mode: "stex",
               theme: "default",
               lineNumbers: true,
               lineWrapping: true
          });

          async function compileLatex() {
               const code = editor.getValue();
               document.getElementById("error-box").style.display = "none";

               const res = await fetch("/compile-latex", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ source: code })
               });

               const data = await res.json();

               if (data.error) {
                    document.getElementById("error-box").innerText = data.error;
                    document.getElementById("error-box").style.display = "block";
               } else {
                    document.getElementById("pdf-viewer").src = "/static/" + data.pdf_path + "?t=" + Date.now();
               }
          }
     </script>
</body>

</html>